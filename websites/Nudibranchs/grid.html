<!DOCTYPE html>
<html>
<head>
    <title>Opisthobranchs of Sodwana Bay</title>
    <meta charset="utf-8" />
    <link href="css/Site.css" rel="stylesheet" />
    <link href="css/featherlight.min.css" rel="stylesheet">
    <script src="libs/jquery-3.1.1.min.js"></script>
    <script src="libs/Masonry.js"></script>
    <script src="libs/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/site.js"></script>
    <script src="js/AddSpecies.js"></script>
    <script>

        // add layout event
        var _postLayout = Masonry.prototype._postLayout;

        Masonry.prototype._postLayout = function () {
            _postLayout.apply(this, arguments);
            this.emitEvent('layout', [this]);
        };

        function addSpec(template, spec) {
            if (spec.wormsid != '') {
                template = template.replace(/<genusname \/> <specname \/>/g, "<a href='https://www.marinespecies.org/aphia.php?p=taxdetails&id=<wormsid />' target='_blank'><genusname /> <specname /></a>");
            }
            if (spec.reviewed != 'Y') {
                template = template
                    .replace(/<genusname \/>/g, "*<genusname />")
            }
            template = template
                .replace(/<imgfilename \/>/g, spec.photo)
                .replace(/<photographer \/>/g, spec.photographer)
                .replace(/<genusname \/>/g, spec.genus)
                .replace(/<specname \/>/g, spec.species)
                .replace(/<specff \/>/g, spec.ssfpage)
                .replace(/<desc \/>/g, spec.description)
                .replace(/<habitat \/>/g, spec.habitat)
                .replace(/<food \/>/g, spec.food)
                .replace(/<depth \/>/g, spec.depthrange)
                .replace(/<wormsid \/>/g, spec.wormsid)
                .replace(/<described \/>/g, spec.described)
                .replace(/<ratio \/>/g, spec.sizeratio)
                .replace(/<nameinfo \/>/g, spec.nameinfo)
                .replace(/<ename \/>/g, spec.name)
                .replace(/<size \/>/g, spec.size);

            $("#gridcontainer").append(template);
        }

        function addGridTiles() {
            $.ajaxSetup({
                // Disable caching of AJAX responses
                cache: false
            });

            const urlParams = new URLSearchParams(window.location.search);
            var popuptemplatefile = 'fstemplate.html';
            if (urlParams.has('RM') || urlParams.has('rm')) {
                popuptemplatefile = 'fstemplate_rm.html';
            }
            $.get(popuptemplatefile, function (pu_template) {
                $.get('tiletemplate.html', function (data) {
                    // inject the popup window template
                    data = data.replace(/<popuptemplate \/>/g, pu_template);
                    addSpecies(data);

                    var $container = $('#gridcontainer').masonry({
                        isFitWidth: true,
                        isInitLayout: false
                    });

                    var $proxy = $('#gridcontainer');

                    // bind on layout
                    $container.masonry('on', 'layout', function () {
                        $proxy.width($container.width());
                    });

                    // init masonry
                    $container.masonry();
                }, 'text');
            }, 'text');

            
        }

        function onload() {
            addGridTiles();
        }
    </script>
</head>
<body id="gridpagebody" onload="onload();" oncontextmenu="return false;">
    <div id="pageheaderdiv"></div>
    <div id="pagebodydiv" style="color:silver">
        <div id="gridcontainer"></div>
    </div>
    <div id="pagefooterdiv"></div>
</body>
</html>






































