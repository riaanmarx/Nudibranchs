<!DOCTYPE html>
<html>
<head>
    <title>Opisthobranchs of Sodwana Bay</title>
    <meta charset="utf-8" />
    <link href="css/Site.css" rel="stylesheet" />
    <script src="libs/jquery-3.1.1.min.js"></script>
    <script src="js/site.js"></script>
    <link href="css/featherlight.min.css" rel="stylesheet">
    <script src="libs/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="libs/es6-promise.min.js"></script>
    <script src="tablefilter/tablefilter.js"></script>
    <script src="js/AddSpecies.js"></script>

</head>
<body onload="addTableLines()">
    <div id="pageheaderdiv"></div>

    <div id="pagebodydiv">
        <table id="listtable" style="color: whitesmoke; background-color: rgba(64, 64, 64, 1);">
            <thead>
                <tr class="tableheader">
                    <th class="headertd">Photo, Species &amp; Photographer</th>
                    <th class="headertd">Order</th>
                    <th class="headertd">Family</th>
                    <th class="headertd">Body Type</th>
                    <th class="headertd">Background Color</th>
                    <th class="headertd">Lines</th>
                    <th class="headertd">Patches</th>
                    <th class="headertd">Rings</th>
                    <th class="headertd">Margins</th>
                    <th class="headertd">Dorsal Appendadges</th>
                    <th class="headertd">Oral Appendadges</th>
                    <th class="headertd">Rhinophores</th>
                    <th class="headertd">Gills</th>
                    <th class="headertd">Name</th>
                    <th class="headertd">Other</th>
                    <th class="headertd">Food</th>
                </tr>
            </thead>
            <tbody id="tablebody">
                <!--species rows will be injected here-->
            </tbody>
        </table> 
    </div>
    
    <script>

        function addSpec(template, spec) {
            if (spec.wormsid != '') {
                template = template.replace(/<genus \/> <species \/>/g, "<a href='https://www.marinespecies.org/aphia.php?p=taxdetails&id=<wormsid />' target='_blank'><genus /> <species /></a>");
            }
            if (spec.reviewed != 'Y') {
                template = template
                    .replace(/<genus \/>/g, "*<genus />")
            }
            // loop through all the properties of the spec object and replace tags in template
            Object.getOwnPropertyNames(spec).forEach(key => {
                tag = new RegExp(`<${key} />`, "g");
                template = template.replace(tag, spec[key]);
            });

            // append row to table
            $("#tablebody").append(template);
        }

        var TemplateHTML;
        function addTableLines() {
            $.get('listrowtemplate.html', function (rowtemplatehtml)
            {
                // remember the row template
                TemplateHTML = rowtemplatehtml;

                const urlParams = new URLSearchParams(window.location.search);
                var popuptemplatefile = 'fstemplate.html';
                if (urlParams.has('RM') || urlParams.has('rm')) {
                    popuptemplatefile = 'fstemplate_rm.html';
                }
                $.get(popuptemplatefile, function (pu_template) {
                    $.get('tiletemplate.html', function (tiletemplatehtml) {
                        // inject the popup window template
                        tiletemplatehtml = tiletemplatehtml.replace(/<popuptemplate \/>/g, pu_template);

                        // replace the tile template tag with the tile template html
                        TemplateHTML = TemplateHTML.replace(/<tiletemplate \/>/g, tiletemplatehtml);

                        // add all the list rows
                        addSpecies(TemplateHTML);

                        // initialize the table filter 
                        var filtersConfig = {
                            base_path: 'tablefilter/',
                            btn_reset: true,
                            rows_counter: true,
                            loader: true,
                            filters_row_index: 1,
                            auto_filter: true,
                            mark_active_columns: true,
                            highlight_keywords: false,
                            col_1: 'select',
                            col_2: 'select',
                            col_3: 'select',
                            col_4: 'select',
                            col_5: 'select',
                            no_results_message: true,
                            sticsticky_headers: true,
                            alternate_rows: true,
                            extensions: [{ name: 'sort' }]
                        };

                        var tf = new TableFilter(document.querySelector('#listtable'), filtersConfig);
                        tf.init();

                    }, 'text');
                }, 'text');
            }, 'text');           
        }
                
    </script>
    <div id="pagefooterdiv"></div>
</body>
</html>














































